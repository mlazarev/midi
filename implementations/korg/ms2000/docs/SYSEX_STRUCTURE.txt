================================================================================
KORG MS2000 PROGRAM DATA DUMP - COMPLETE STRUCTURE DIAGRAM
================================================================================

FILE STRUCTURE OVERVIEW
================================================================================

┌─────────────────────────────────────────────────────────────────────────────┐
│ COMPLETE SYSEX FILE                                                         │
│ Total Size: ~36,000-37,000 bytes (varies by number of patches)             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ┌──────────────────────────────────────────┐                               │
│ │ HEADER (5 bytes)                         │                               │
│ ├──────────────────────────────────────────┤                               │
│ │ F0  42  30  58  4C                       │                               │
│ │ │   │   │   │   │                        │                               │
│ │ │   │   │   │   └─ Function: PROGRAM DUMP                               │
│ │ │   │   │   └───── Device: MS2000        │                               │
│ │ │   │   └───────── MIDI Channel: 0       │                               │
│ │ │   └───────────── Manufacturer: Korg    │                               │
│ │ └───────────────── SysEx Start           │                               │
│ └──────────────────────────────────────────┘                               │
│                                                                             │
│ ┌──────────────────────────────────────────┐                               │
│ │ ENCODED DATA STREAM                      │                               │
│ │ (~35,995 - 37,153 bytes)                 │                               │
│ ├──────────────────────────────────────────┤                               │
│ │                                          │                               │
│ │  7-to-8 bit encoded patch data          │                               │
│ │  (see encoding details below)           │                               │
│ │                                          │                               │
│ │  When decoded: 31,496 - 32,514 bytes    │                               │
│ │  = 124-128 patches × 254 bytes/patch    │                               │
│ │                                          │                               │
│ └──────────────────────────────────────────┘                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘


7-TO-8 BIT ENCODING SCHEME
================================================================================

CONCEPTUAL VIEW:
┌──────────────────────────┐       ┌────────────────────────────┐
│  RAW PATCH DATA          │       │  ENCODED MIDI DATA         │
│  (8-bit bytes)           │ ====> │  (7-bit bytes)             │
│                          │       │                            │
│  7 bytes                 │       │  8 bytes                   │
│  Values: 0-255           │       │  Values: 0-127             │
└──────────────────────────┘       └────────────────────────────┘

DETAILED ENCODING:
┌─────────────────────────────────────────────────────────────────────────────┐
│ INPUT: 7 bytes of 8-bit data                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   Byte[0]: b7 b6 b5 b4 b3 b2 b1 b0                                         │
│   Byte[1]: b7 b6 b5 b4 b3 b2 b1 b0                                         │
│   Byte[2]: b7 b6 b5 b4 b3 b2 b1 b0                                         │
│   Byte[3]: b7 b6 b5 b4 b3 b2 b1 b0                                         │
│   Byte[4]: b7 b6 b5 b4 b3 b2 b1 b0                                         │
│   Byte[5]: b7 b6 b5 b4 b3 b2 b1 b0                                         │
│   Byte[6]: b7 b6 b5 b4 b3 b2 b1 b0                                         │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ ENCODE
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│ OUTPUT: 8 bytes of 7-bit data                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   Byte[0]: 0 b7₆ b7₅ b7₄ b7₃ b7₂ b7₁ b7₀  ← MSB COLLECTION BYTE          │
│            │ │   │   │   │   │   │   │                                     │
│            │ │   │   │   │   │   │   └── Bit 7 from input byte 0          │
│            │ │   │   │   │   │   └────── Bit 7 from input byte 1          │
│            │ │   │   │   │   └────────── Bit 7 from input byte 2          │
│            │ │   │   │   └────────────── Bit 7 from input byte 3          │
│            │ │   │   └────────────────── Bit 7 from input byte 4          │
│            │ │   └────────────────────── Bit 7 from input byte 5          │
│            │ └────────────────────────── Bit 7 from input byte 6          │
│            └──────────────────────────── Always 0 (MIDI data byte)         │
│                                                                             │
│   Byte[1]: 0 b6 b5 b4 b3 b2 b1 b0  ← Lower 7 bits of input byte 0         │
│   Byte[2]: 0 b6 b5 b4 b3 b2 b1 b0  ← Lower 7 bits of input byte 1         │
│   Byte[3]: 0 b6 b5 b4 b3 b2 b1 b0  ← Lower 7 bits of input byte 2         │
│   Byte[4]: 0 b6 b5 b4 b3 b2 b1 b0  ← Lower 7 bits of input byte 3         │
│   Byte[5]: 0 b6 b5 b4 b3 b2 b1 b0  ← Lower 7 bits of input byte 4         │
│   Byte[6]: 0 b6 b5 b4 b3 b2 b1 b0  ← Lower 7 bits of input byte 5         │
│   Byte[7]: 0 b6 b5 b4 b3 b2 b1 b0  ← Lower 7 bits of input byte 6         │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

EXAMPLE WITH PATCH NAME "Stab":
┌─────────────────────────────────────────────────────────────────────────────┐
│ INPUT (ASCII "Stab"):                                                      │
│   0x53 ('S') = 0101 0011                                                   │
│   0x74 ('t') = 0111 0100                                                   │
│   0x61 ('a') = 0110 0001                                                   │
│   0x62 ('b') = 0110 0010                                                   │
│   0x20 (' ') = 0010 0000                                                   │
│   0x53 ('S') = 0101 0011                                                   │
│   0x61 ('a') = 0110 0001                                                   │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│ OUTPUT (7-bit encoded):                                                    │
│   0x00 = 0000 0000  ← MSB byte: all high bits are 0                       │
│   0x53 = 0101 0011  ← 'S' (unchanged since bit 7 = 0)                     │
│   0x74 = 0111 0100  ← 't' (unchanged since bit 7 = 0)                     │
│   0x61 = 0110 0001  ← 'a' (unchanged since bit 7 = 0)                     │
│   0x62 = 0110 0010  ← 'b' (unchanged since bit 7 = 0)                     │
│   0x20 = 0010 0000  ← ' ' (unchanged since bit 7 = 0)                     │
│   0x53 = 0101 0011  ← 'S' (unchanged since bit 7 = 0)                     │
│   0x61 = 0110 0001  ← 'a' (unchanged since bit 7 = 0)                     │
└─────────────────────────────────────────────────────────────────────────────┘

Note: ASCII characters (0-127) have bit 7 = 0, so they pass through unchanged!


DECODED PATCH DATA STRUCTURE
================================================================================

After decoding, each patch is exactly 254 bytes:

┌─────────────────────────────────────────────────────────────────────────────┐
│ SINGLE PATCH (254 bytes decoded)                                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ┌───────────────────────────────────────────────────────────────┐          │
│ │ Bytes 0-11: PROGRAM NAME (12 ASCII characters)                │          │
│ ├───────────────────────────────────────────────────────────────┤          │
│ │ Example: "Stab Saw    " (padded with spaces)                 │          │
│ └───────────────────────────────────────────────────────────────┘          │
│                                                                             │
│ ┌───────────────────────────────────────────────────────────────┐          │
│ │ Bytes 12-15: RESERVED (not used)                             │          │
│ └───────────────────────────────────────────────────────────────┘          │
│                                                                             │
│ ┌───────────────────────────────────────────────────────────────┐          │
│ │ Byte 16: VOICE MODE & TIMBRE                                 │          │
│ ├───────────────────────────────────────────────────────────────┤          │
│ │   Bits 6-7: Timbre Voice (0-2)                               │          │
│ │   Bits 4-5: Voice Mode (0-3)                                 │          │
│ │     0 = Single   1 = Split   2 = Layer   3 = Vocoder         │          │
│ │   Bits 0-3: Reserved                                         │          │
│ └───────────────────────────────────────────────────────────────┘          │
│                                                                             │
│ ┌───────────────────────────────────────────────────────────────┐          │
│ │ Byte 17: SCALE                                                │          │
│ ├───────────────────────────────────────────────────────────────┤          │
│ │   Bits 4-7: Scale Key (0-11 = C, C#, D...B)                  │          │
│ │   Bits 0-3: Scale Type (0-9)                                 │          │
│ └───────────────────────────────────────────────────────────────┘          │
│                                                                             │
│ ┌───────────────────────────────────────────────────────────────┐          │
│ │ Byte 18: SPLIT POINT (0-127 = MIDI note C-1 to G9)           │          │
│ └───────────────────────────────────────────────────────────────┘          │
│                                                                             │
│ ┌───────────────────────────────────────────────────────────────┐          │
│ │ Bytes 19-22: DELAY FX                                         │          │
│ ├───────────────────────────────────────────────────────────────┤          │
│ │ Byte 19: Sync + Timebase                                     │          │
│ │   Bit 7: Sync (0=Off, 1=On)                                  │          │
│ │   Bits 0-3: Timebase (0-14 = 1/32 to 1/1)                    │          │
│ │ Byte 20: Delay Time (0-127)                                  │          │
│ │ Byte 21: Depth (0-127)                                       │          │
│ │ Byte 22: Type (0=Stereo, 1=Cross, 2=L/R)                     │          │
│ └───────────────────────────────────────────────────────────────┘          │
│                                                                             │
│ ┌───────────────────────────────────────────────────────────────┐          │
│ │ Bytes 23-25: MOD FX                                           │          │
│ ├───────────────────────────────────────────────────────────────┤          │
│ │ Byte 23: LFO Speed (0-127)                                   │          │
│ │ Byte 24: Depth (0-127)                                       │          │
│ │ Byte 25: Type (0=Cho/Flg, 1=Ensemble, 2=Phaser)              │          │
│ └───────────────────────────────────────────────────────────────┘          │
│                                                                             │
│ ┌───────────────────────────────────────────────────────────────┐          │
│ │ Bytes 26-29: EQ                                               │          │
│ ├───────────────────────────────────────────────────────────────┤          │
│ │ Byte 26: Hi Frequency (0-29 = 1.0-18.0 KHz)                  │          │
│ │ Byte 27: Hi Gain (64+/-12 = 0+/-12)                          │          │
│ │ Byte 28: Low Frequency (0-29 = 40-1000 Hz)                   │          │
│ │ Byte 29: Low Gain (64+/-12 = 0+/-12)                         │          │
│ └───────────────────────────────────────────────────────────────┘          │
│                                                                             │
│ ┌───────────────────────────────────────────────────────────────┐          │
│ │ Bytes 30-33: ARPEGGIATOR                                      │          │
│ ├───────────────────────────────────────────────────────────────┤          │
│ │ Bytes 30-31: Tempo (16-bit MSB/LSB, 20-300 BPM)              │          │
│ │ Byte 32: Flags                                               │          │
│ │   Bit 7: On/Off (0=Off, 1=On)                                │          │
│ │   Bit 6: Latch (0=Off, 1=On)                                 │          │
│ │   Bits 4-5: Target (0=Both, 1=Timb1, 2=Timb2)                │          │
│ │   Bit 0: Key Sync (0=Off, 1=On)                              │          │
│ │ Byte 33: Type + Range                                        │          │
│ │   Bits 0-3: Type (0-5 = Up, Down, Alt1, Alt2, Rand, Trig)    │          │
│ │   Bits 4-7: Range (0-3 = 1-4 octaves)                        │          │
│ └───────────────────────────────────────────────────────────────┘          │
│                                                                             │
│ ┌───────────────────────────────────────────────────────────────┐          │
│ │ Bytes 34-253: OSCILLATORS, FILTERS, ENVELOPES, LFOs, etc.    │          │
│ ├───────────────────────────────────────────────────────────────┤          │
│ │ (220 bytes - see MS2000 MIDI Implementation doc for details) │          │
│ │                                                               │          │
│ │ Contains:                                                     │          │
│ │  - Oscillator 1 & 2 settings (waveform, pitch, modulation)   │          │
│ │  - Noise generator                                           │          │
│ │  - Filter settings (cutoff, resonance, type, envelope)       │          │
│ │  - Amplifier envelope                                        │          │
│ │  - LFO 1 & 2 settings                                        │          │
│ │  - Portamento                                                │          │
│ │  - Modulation matrix (patch points)                          │          │
│ │  - Motion sequencer steps                                    │          │
│ │  - Vocoder settings (if in vocoder mode)                     │          │
│ └───────────────────────────────────────────────────────────────┘          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘


COMPLETE FILE LAYOUT
================================================================================

OriginalPatches.syx (36,000 bytes total):
┌─────────────────────────────────────────────────────────────────────────────┐
│ Offset  │ Content                                                           │
├─────────┼───────────────────────────────────────────────────────────────────┤
│ 0x0000  │ F0 42 30 58 4C (Header)                                           │
│ 0x0005  │ [Encoded Patch 1 data begins]                                     │
│         │   After decoding: "Stab Saw    " + parameters                     │
│ 0x0127  │ [Encoded Patch 2 data begins] (0x122 = 290 bytes later)          │
│         │   After decoding: "Synth Lana  " + parameters                     │
│ 0x0249  │ [Encoded Patch 3 data begins]                                     │
│         │   After decoding: "Evolution   " + parameters                     │
│   ...   │   ...                                                             │
│ ~0x8BFF │ [Encoded Patch 124 data ends]                                     │
│ 0x8C9F  │ [End of file]                                                     │
└─────────┴───────────────────────────────────────────────────────────────────┘

BOCPatches.syx (37,158 bytes total):
┌─────────────────────────────────────────────────────────────────────────────┐
│ Offset  │ Content                                                           │
├─────────┼───────────────────────────────────────────────────────────────────┤
│ 0x0000  │ F0 42 30 58 4C (Header)                                           │
│ 0x0005  │ [Encoded Patch 1 data begins]                                     │
│         │   After decoding: "" (blank name) + custom parameters             │
│   ...   │   ... 128 patches total ...                                       │
│ 0x9115  │ [Encoded Patch 128 data ends]                                     │
│ 0x9116  │ [End of file]                                                     │
└─────────┴───────────────────────────────────────────────────────────────────┘


DECODING PROCESS FLOWCHART
================================================================================

┌────────────────┐
│  Read SysEx    │
│  File          │
└───────┬────────┘
        │
        ▼
┌────────────────┐
│  Verify Header │
│  F0 42 30 58 4C│
└───────┬────────┘
        │
        ▼
┌────────────────┐
│  Skip 5-byte   │
│  Header        │
└───────┬────────┘
        │
        ▼
┌────────────────────────────┐
│  Decode ENTIRE Data Stream │
│  Using 7-to-8 Algorithm    │
│                            │
│  Input: 35,995 bytes       │
│  Output: 31,496 bytes      │
└───────┬────────────────────┘
        │
        ▼
┌────────────────────────────┐
│  Extract Patches as        │
│  Sequential 254-byte       │
│  Chunks                    │
│                            │
│  Patch 1: bytes 0-253      │
│  Patch 2: bytes 254-507    │
│  Patch 3: bytes 508-761    │
│  ...                       │
└───────┬────────────────────┘
        │
        ▼
┌────────────────┐
│  Parse Each    │
│  Patch         │
│  Parameters    │
└────────────────┘


MEMORY EFFICIENCY ANALYSIS
================================================================================

Raw Patch Data (unencoded):
  128 patches × 254 bytes = 32,512 bytes

After 7-to-8 Encoding:
  Every 7 bytes → 8 bytes
  32,512 bytes ÷ 7 = 4,644.57 groups
  4,644.57 × 8 = 37,156.57 ≈ 37,157 bytes

With Header:
  37,157 + 5 = 37,162 bytes total

Overhead:
  (37,162 - 32,512) ÷ 32,512 = 14.3% size increase

This matches the actual file sizes observed:
  OriginalPatches.syx: 36,000 bytes (124 patches = slightly less)
  BOCPatches.syx: 37,158 bytes (128 patches = matches calculation!)


================================================================================
END OF STRUCTURE DOCUMENTATION
================================================================================
